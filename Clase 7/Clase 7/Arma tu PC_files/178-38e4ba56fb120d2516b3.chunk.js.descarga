(("undefined"!==typeof self?self:this).webpackJsonp=("undefined"!==typeof self?self:this).webpackJsonp||[]).push([[178],{1399:function(e,t,o){"use strict";o.r(t);var i,n,r=o(1),d=o(8),a=o(37),s=o(84),l=o(3),p=o(126),c=o(77),u=function(e,t,o,i){var n,r=arguments.length,d=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)d=Reflect.decorate(e,t,o,i);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(d=(r<3?n(d):r>3?n(t,o,d):n(t,o))||d);return r>3&&d&&Object.defineProperty(t,o,d),d},h=function(e,t){if("object"===typeof Reflect&&"function"===typeof Reflect.metadata)return Reflect.metadata(e,t)};const f=Object(d.d)("draft"),y=Object(d.d)("snackbars"),g=Object(d.d)("composerModal"),v=Object(d.d)("composerModalAlert"),b=Object(d.d)("confirmationDialog"),A=Object(d.d)("dragAndDropEvents"),m=Object(d.d)("post"),D=Object(d.d)("table"),k=Object(d.d)("browser");let C=class extends(Object(r.c)()){constructor(){super(...arguments),this.xBulkActionMenu=!1,this.bulkActionPopoverAnchor={}}get pendingPostReadyToUploadCids(){if(this.isTable)return this.tablePostsToUpload.filter(e=>!!e.file).map(e=>e.cid);const e=this.pendingPosts.filter(e=>!!e.file);if(this.isSectioned){return e.filter(e=>!!e.wall_section_id).map(e=>e.cid)}return e.map(e=>e.cid)}get isComposerModalExpanded(){return this.isAnyDraftActive&&this.isComposerModalExpandedWhenOpened}respondToNewPendingPostsReadyToUpload(e){0!==e.length&&(e.forEach(e=>{const t=this.pendingPostEntitiesByCid[e];t.file&&this.createNewDraftFromPendingUpload({file:t.file,postAttributes:t})}),this.removePendingPosts({cids:e}))}respondToActiveDraftChanges(e){e&&!Object(s.j)(e)&&this.expandComposerModal()}respondToWindowSizeChanges(){this.updateBulkActionPopoverAnchor()}hideMarginStyle(e){return this.draftCids.length<2?{}:this.isCidActiveDraft(e)&&this.isComposerModalExpandedWhenOpened?{marginRight:"0px"}:{}}uploadingFileByCid(e){var t;return null===(t=this.draftByCid(e))||void 0===t?void 0:t.uploadingFile}maxFileUploadSizeByCid(e){var t;return(null===(t=this.draftByCid(e))||void 0===t?void 0:t.maxFileUploadSize)||this.uploadLimit}onUploadError(e,t,o){var i;this.stopUploadFileInDraft({cid:o}),this.stopAutoPublishDraft({cid:o}),this.isCidActiveDraft(o)?this.openAlert({title:this.__("There was an error loading the attachment"),body:t,primaryActionText:this.__("Try again"),secondaryActionText:this.__("Cancel"),primaryActions:[{type:"draft/uploadFileActiveDraft",payload:{file:e,maxFileUploadSize:null===(i=this.draftByCid(o))||void 0===i?void 0:i.maxFileUploadSize}}],secondaryActions:[]}):this.setSnackbar({message:t})}onUploadCancel(e,t){var o;this.stopAutoPublishDraft({cid:t}),(null===(o=this.draftByCid(t))||void 0===o?void 0:o.uploadingFile)&&this.stopUploadFileInDraft({cid:t})}onUploadReject(e,t,o){this.stopUploadFileInDraft({cid:o}),this.stopAutoPublishDraft({cid:o}),this.showOverFileSizeModal({file:e})}onUploadDone(e,t,o){var i;this.stopUploadFileInDraft({cid:o}),this.updateDraft({cid:o,attachment:t,wish_content:{attachment_props:{url:t},is_processed:!1}}),(null===(i=this.draftByCid(o))||void 0===i?void 0:i.shouldAutoPublish)&&this.savePost({attributes:this.draftByCid(o)})}checkUnsavedDraft(e){if(!this.draftCids.some(e=>{const t=this.draftByCid(e);if(!t)return!1;const o=this.getPostByCid(e),i=Object(s.j)(t)&&Object(s.k)(t),n=!!t.uploadingFile,r=t.subject!==(null===o||void 0===o?void 0:o.subject)||t.body!==(null===o||void 0===o?void 0:o.body)||t.attachment!==(null===o||void 0===o?void 0:o.attachment)||t.attachment_caption!==(null===o||void 0===o?void 0:o.attachment_caption);return i||n||r}))return;const t=this.__("It looks like you have unsaved changes. Are you sure you want to discard them and close this page?");return e.returnValue=t,t}openBulkActionMenu(){this.updateBulkActionPopoverAnchor(),this.xBulkActionMenu=!0}closeBulkActionMenu(){this.xBulkActionMenu=!1}updateBulkActionPopoverAnchor(){const e=this.$refs.bulkActionButton;if(!e)return void(this.bulkActionPopoverAnchor={});const t=e.$el.getBoundingClientRect();this.bulkActionPopoverAnchor={top:t.top,left:t.left-18,width:t.width+32}}publishAllDrafts(){this.closeBulkActionMenu();[...this.draftCids].reverse().forEach(e=>{this.publishDraft({cid:e})})}deleteAllDrafts(){this.closeBulkActionMenu(),this.openConfirmationDialog(Object.assign(Object.assign({},p.a),{isCodeProtected:!1,title:this.__("Delete all drafts?"),body:this.__("You can't undo this action."),confirmButtonText:this.__("Delete drafts"),cancelButtonText:this.__("Cancel"),afterConfirmActions:[{type:"draft/deleteAllDrafts"}],buttonScheme:c.a.Danger,forceFullWidthButtons:!0,xShadow:this.isUsingNewSurfaceShadows}))}mounted(){l.a.addEventListener("beforeunload",this.checkUnsavedDraft)}beforeDestroy(){l.a.removeEventListener("beforeunload",this.checkUnsavedDraft)}};u([d.b,h("design:type",Number)],C.prototype,"uploadLimit",void 0),u([d.b,h("design:type",Boolean)],C.prototype,"isSectioned",void 0),u([d.b,h("design:type",Boolean)],C.prototype,"isTable",void 0),u([d.b,h("design:type",Boolean)],C.prototype,"isUsingNewSurfaceShadows",void 0),u([f.Getter,h("design:type","function"===typeof(i="undefined"!==typeof a.DraftPost&&a.DraftPost)?i:Object)],C.prototype,"activeDraft",void 0),u([f.Getter,h("design:type",Array)],C.prototype,"draftCids",void 0),u([f.Getter,h("design:type",Function)],C.prototype,"draftByCid",void 0),u([f.Getter,h("design:type",Function)],C.prototype,"isCidActiveDraft",void 0),u([f.Getter,h("design:type",Boolean)],C.prototype,"isAnyDraftActive",void 0),u([f.Getter,h("design:type",Object)],C.prototype,"activeDraftUploadingFile",void 0),u([m.Getter,h("design:type",Array)],C.prototype,"pendingPosts",void 0),u([m.Getter,h("design:type","function"===typeof(n="undefined"!==typeof Record&&Record)?n:Object)],C.prototype,"pendingPostEntitiesByCid",void 0),u([m.Getter,h("design:type",Function)],C.prototype,"getPostByCid",void 0),u([D.Getter("postsPendingUpload"),h("design:type",Array)],C.prototype,"tablePostsToUpload",void 0),u([g.Getter("isExpanded"),h("design:type",Boolean)],C.prototype,"isComposerModalExpandedWhenOpened",void 0),u([A.Getter("isHandlingDragEvent"),h("design:type",Boolean)],C.prototype,"isPageHandlingDragEvent",void 0),u([k.Getter,h("design:type",Number)],C.prototype,"windowWidth",void 0),u([k.Getter,h("design:type",Number)],C.prototype,"windowHeight",void 0),u([d.a,h("design:type",Function)],C.prototype,"showOverFileSizeModal",void 0),u([y.Action,h("design:type",Function)],C.prototype,"setSnackbar",void 0),u([f.Action,h("design:type",Function)],C.prototype,"stopUploadFileInDraft",void 0),u([f.Action,h("design:type",Function)],C.prototype,"updateDraft",void 0),u([f.Action,h("design:type",Function)],C.prototype,"createNewDraftFromPendingUpload",void 0),u([f.Action,h("design:type",Function)],C.prototype,"stopAutoPublishDraft",void 0),u([v.Action,h("design:type",Function)],C.prototype,"openAlert",void 0),u([m.Action,h("design:type",Function)],C.prototype,"removePendingPosts",void 0),u([m.Action,h("design:type",Function)],C.prototype,"savePost",void 0),u([g.Action("expand"),h("design:type",Function)],C.prototype,"expandComposerModal",void 0),u([Object(r.g)("pendingPostReadyToUploadCids"),h("design:type",Function),h("design:paramtypes",[Array]),h("design:returntype",void 0)],C.prototype,"respondToNewPendingPostsReadyToUpload",null),u([Object(r.g)("activeDraft"),h("design:type",Function),h("design:paramtypes",[Object]),h("design:returntype",void 0)],C.prototype,"respondToActiveDraftChanges",null),u([Object(r.g)("windowWidth"),Object(r.g)("windowHeight"),h("design:type",Function),h("design:paramtypes",[]),h("design:returntype",void 0)],C.prototype,"respondToWindowSizeChanges",null),u([f.Action,h("design:type",Function)],C.prototype,"publishDraft",void 0),u([b.Action,h("design:type",Function)],C.prototype,"openConfirmationDialog",void 0),C=u([Object(r.a)({components:{SurfaceComposerModalNew:()=>Promise.all([o.e(2),o.e(169),o.e(3),o.e(5),o.e(123)]).then(o.bind(null,1371)),OzBaseButton:()=>Promise.resolve().then(o.bind(null,89)),OzIcon:()=>Promise.resolve().then(o.bind(null,36)),SurfaceDraftBulkActionPopover:()=>Promise.all([o.e(2),o.e(5),o.e(166)]).then(o.bind(null,1418))}})],C);var P=C,B=o(5),x=Object(B.a)(P,(function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{class:["fixed","top-0","bottom-0","right-0","left-0","pointer-events-none","inline-flex","items-end","flex-row-reverse","space-x-reverse","space-x-4","z-backdrop","pl-8","pr-[6.5rem]",e.isPageHandlingDragEvent&&"bg-grape-500 dark:bg-drag-overlay-dark bg-opacity-50 dark:bg-opacity-35"]},[e.draftCids.length>1?o("div",{staticClass:"flex-shrink-0 pointer-events-auto"},[o("OzBaseButton",{ref:"bulkActionButton",class:["h-10","w-10","p-0","grid","place-items-center","rounded-t-xl","bg-light-ui-100","dark:bg-dark-ui-100","text-dark-text-200 dark:text-light-text-200","hover-hover:hover:text-dark-text-100 hover-hover:dark:hover:text-light-text-100","focus:text-grape-500 dark:focus:text-canary-500","active:text-grape-500 dark:active:text-canary-500",e.isUsingNewSurfaceShadows&&"shadow-elevation-2"],on:{click:e.openBulkActionMenu}},[o("OzIcon",{attrs:{name:"bulk_action",size:24}})],1),e._v(" "),e.xBulkActionMenu?o("SurfaceDraftBulkActionPopover",{attrs:{"popover-anchor":e.bulkActionPopoverAnchor},on:{cancel:e.closeBulkActionMenu,"publish-all":e.publishAllDrafts,"delete-all":e.deleteAllDrafts}}):e._e()],1):e._e(),e._v(" "),e._l(e.draftCids,(function(t){return o("surface-composer-modal-new",{key:t,style:e.hideMarginStyle(t),attrs:{"draft-cid":t,file:e.uploadingFileByCid(t),"max-file-size":e.maxFileUploadSizeByCid(t)},on:{error:function(o,i){return e.onUploadError(o,i,t)},cancel:function(o){return e.onUploadCancel(o,t)},done:function(o,i){return e.onUploadDone(o,i,t)},reject:function(o,i){return e.onUploadReject(o,i,t)}}})}))],2)}),[],!1,null,null,null);t.default=x.exports}}]);
//# sourceMappingURL=178-38e4ba56fb120d2516b3.chunk.js.map